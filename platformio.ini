; PlatformIO Project Configuration for OBI ESP32
;
; Open Battery Information - ESP32-C3 Super Mini version
; Communicates with Makita LXT batteries via modified OneWire protocol
;
; Hardware:
;   - OneWire Data: GPIO3
;   - Enable Pin: GPIO4
;   - Pull-up resistors: 4.7kÎ© to 3.3V on both data lines

[env:esp32c3]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino

; MCU settings
board_build.mcu = esp32c3
board_build.f_cpu = 160000000L
board_build.flash_mode = dio
board_build.f_flash = 80000000L

; Build flags - USB CDC and pin definitions
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DONEWIRE_PIN=3
    -DENABLE_PIN=4

; Monitor settings
monitor_port = /dev/ttyACM0
monitor_speed = 115200
monitor_filters = direct, esp32_exception_decoder

; Upload settings
upload_speed = 921600
upload_port = /dev/ttyACM0

; Library dependencies
lib_deps =
    ; Web server for Phase 2
    ; me-no-dev/ESPAsyncWebServer @ ^1.2.3

[env:esp32c3_web]
extends = env:esp32c3
build_flags =
    ${env:esp32c3.build_flags}
    -DENABLE_WEB_SERVER=1

lib_deps =
    bblanchon/ArduinoJson @ ^7.0.0

; OTA upload environment - use after initial USB flash
[env:esp32c3_ota]
extends = env:esp32c3_web
upload_protocol = espota
upload_port = 192.168.25.110

